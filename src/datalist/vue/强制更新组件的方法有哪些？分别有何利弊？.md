## 12. 强制更新组件的方法有哪些？分别有何利弊？

### 12.1. `this.$forceUpdate()`

#### 12.1.1. **原理**

强制当前组件实例重新渲染，跳过虚拟 DOM 的 Diff 过程，直接调用 `render` 函数生成新 VNode 并更新 DOM。

#### 12.1.2. **使用方式**

```
// 选项式 API
this.$forceUpdate();

// 组合式 API（Vue 3）
import { getCurrentInstance } from 'vue';
const instance = getCurrentInstance();
instance.proxy.$forceUpdate();
```

#### 12.1.3. **优点**

- **简单直接**：无需修改数据或结构
- **局部更新**：仅影响当前组件及其子组件

#### 12.1.4. **缺点**

- **违背响应式原则**：掩盖数据未正确响应的设计问题
- **性能损耗**：强制全组件树重新渲染，可能引发不必要的子组件更新
- **不解决根本问题**：未修复数据响应性，后续更新仍需手动触发

* * *

### 12.2. **修改组件的** `key`

#### 12.2.1. **原理**

通过改变 `key` 值，使 Vue 认为组件已销毁并重新创建，触发完整生命周期。

#### 12.2.2. **使用方式**

```
// 修改 key 值强制重建组件
this.componentKey = Date.now(); // 或递增计数器
```

#### 12.2.3. **优点**

- **彻底重置组件状态**：适合需要完全重新初始化的场景
- **兼容性强**：适用于任何组件和复杂场景

#### 12.2.4. **缺点**

- **性能开销大**：销毁和重建组件成本高，尤其是复杂组件
- **状态丢失**：组件内部状态（如表单输入）会被重置
- **设计异味**：可能反映组件设计存在耦合问题

* * *

### 12.3. **利用** `v-if` **切换**

#### 12.3.1. **原理**

通过 `v-if="show"` 控制组件挂载/卸载，切换时重新渲染。

#### 12.3.2. **使用方式**

```
// 先卸载再重新挂载
this.show = false;
this.$nextTick(() => {
  this.show = true;
});
```

#### 12.3.3. **优点**

- **控制灵活**：可精确控制重新渲染时机
- **类似** ****`key` ******的效果**：但保留父组件状态

#### 12.3.4. **缺点**

- **代码冗余**：需要手动处理状态保留逻辑
- **闪烁问题**：快速切换可能导致界面闪烁
- **不适用于保持内部状态**：与 `key` 类似，会丢失子组件状态

* * *

### 12.4. **强制更新依赖（响应式系统）**

#### 12.4.1. **原理**

通过修改响应式数据的引用地址，触发依赖更新。

#### 12.4.2. **使用方式**

```
// 对象：替换整个对象
this.obj = { ...this.obj };

// 数组：返回新数组
this.arr = this.arr.slice();
```

#### 12.4.3. **优点**

- **符合响应式规范**：利用 Vue 的响应式机制
- **精准更新**：仅触发相关依赖的重新计算

#### 12.4.4. **缺点**

- **仅适用于引用类型**：基础数据类型无法使用
- **可能引发副作用**：若其他代码依赖原引用，可能导致意外行为

* * *

### 12.5. **使用** `Vue.set` **/** `this.$set`

#### 12.5.1. **原理**

显式声明新增属性为响应式，适用于动态添加未预先声明的属性。

#### 12.5.2. **使用方式**

```
// Vue 2
this.$set(this.obj, 'newKey', 'value');

// Vue 3（通常不需要，Proxy 自动检测）
import { set } from 'vue';
set(this.obj, 'newKey', 'value');
```

#### 12.5.3. **优点**

- **修复数据响应性**：根本解决视图不更新的问题
- **官方推荐**：符合 Vue 设计模式

#### 12.5.4. **缺点**

- **局限性**：仅解决新增属性/数组索引的响应性问题
- **需明确问题根源**：无法修复其他原因导致的更新失败

* * *

### 12.6. **总结与最佳实践**

| **方法**           | **适用场景**      | **推荐指数** | **注意事项**          |
| ---------------- | ------------- | -------- | ----------------- |
| `$forceUpdate()` | 紧急修复、非响应式数据依赖 | ⭐⭐       | 避免滥用，排查数据问题       |
| 修改 `key`         | 需要完全重置组件状态    | ⭐⭐       | 性能敏感场景慎用          |
| `v-if`切换         | 临时强制重建组件      | ⭐        | 可能导致闪烁            |
| 强制更新依赖           | 引用类型数据未触发更新   | ⭐⭐⭐      | 优先选择的响应式方案        |
| `Vue.set`        | 动态添加属性/数组项未响应 | ⭐⭐⭐⭐     | Vue 2 必备，Vue 3 少用
